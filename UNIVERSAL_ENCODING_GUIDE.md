# üåç –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∞–º

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- **Windows:** WIN1251 (–¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞)
- **Linux/macOS:** UTF-8
- **Render.com:** Linux —Å UTF-8

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ Render.

## üöÄ –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `backend/src/utils/encoding.js` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–µ—Ç–µ–∫—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º—ã.

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã**
```javascript
const platform = os.platform();
const isWindows = platform === 'win32';
const isLinux = platform === 'linux';
```

### 2. **–£–º–Ω—ã–π –≤—ã–±–æ—Ä –∫–æ–¥–∏—Ä–æ–≤–∫–∏**
```javascript
function getOptimalEncoding() {
  if (isWindows) {
    return 'WIN1251';  // –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ Windows
  } else {
    return 'UTF8';     // –î–ª—è Linux/macOS/Render
  }
}
```

### 3. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π UTF-8 –≤ production**
```javascript
if (process.env.NODE_ENV === 'production') {
  encodingConfig.client_encoding = 'UTF8';  // –í—Å–µ–≥–¥–∞ UTF-8 –≤ production
}
```

## üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. **backend/src/utils/encoding.js** (–Ω–æ–≤—ã–π)
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
- –£–º–Ω—ã–π –≤—ã–±–æ—Ä –∫–æ–¥–∏—Ä–æ–≤–∫–∏

### 2. **backend/src/utils/db.js** (–æ–±–Ω–æ–≤–ª–µ–Ω)
```javascript
const encoding = require('./encoding');
// ...
dbConfig = encoding.addEncodingToConfig(dbConfig);
```

### 3. **backend/init-db.js** (–æ–±–Ω–æ–≤–ª–µ–Ω)
```javascript
const encoding = require('./src/utils/encoding');
// ...
poolConfig = encoding.addEncodingToConfig(poolConfig);
```

### 4. **test_db_connection.js** (–æ–±–Ω–æ–≤–ª–µ–Ω)
```javascript
const encoding = require('./backend/src/utils/encoding');
// ...
const finalConfig = encoding.addEncodingToConfig(dbConfig);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Windows):
```bash
node test_encoding.js
# –†–µ–∑—É–ª—å—Ç–∞—Ç: client_encoding: 'WIN1251'
```

### –°–∏–º—É–ª—è—Ü–∏—è production:
```bash
NODE_ENV=production node test_encoding.js
# –†–µ–∑—É–ª—å—Ç–∞—Ç: client_encoding: 'UTF8'
```

### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:
```bash
node test_db_connection.js
# ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows, Linux, macOS
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

### ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –í production –≤—Å–µ–≥–¥–∞ UTF-8
- –ù–µ—Ç —Ä–∏—Å–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–æ–∫ –Ω–∞ Render

### ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- Production –¥–µ–ø–ª–æ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ
- –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–∞–º–∏

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–¥–∏—Ä–æ–≤–∫–∞—Ö:

```
Database encoding configuration {
  platform: 'win32',
  isWindows: true,
  isLinux: false,
  selectedEncoding: 'WIN1251',
  nodeEnv: 'development'
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∫–æ–¥–µ:
```javascript
const encoding = require('./utils/encoding');

// –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∫–æ–¥–∏—Ä–æ–≤–∫—É
const optimalEncoding = encoding.getOptimalEncoding();

// –î–æ–±–∞–≤–∏—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ë–î
const dbConfig = encoding.addEncodingToConfig(baseConfig);

// –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
encoding.logEncodingInfo();
```

### –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞
const config = {
  host: 'localhost',
  port: 5432,
  // client_encoding –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
};
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. **Production –≤—Å–µ–≥–¥–∞ UTF-8**
–ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–∏—Å—Ç–µ–º—ã, –≤ production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UTF-8 –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

### 2. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è**
–ù–∞ Windows –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WIN1251, –Ω–∞ Linux - UTF-8.

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–í—Å–µ —Ä–µ—à–µ–Ω–∏—è –æ –∫–æ–¥–∏—Ä–æ–≤–∫–∞—Ö –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–æ–∫ –Ω–∞ Render**
- ‚úÖ **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ**
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ production**

---
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ –ª—é–±—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É! 