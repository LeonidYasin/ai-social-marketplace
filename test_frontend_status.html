<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –±—ç–∫–µ–Ω–¥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .status-online { background-color: #4caf50; }
        .status-offline { background-color: #f44336; }
        .status-unknown { background-color: #9e9e9e; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –±—ç–∫–µ–Ω–¥–∞</h1>
    
    <div class="test-section">
        <h2>üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h2>
        <div id="currentStatus">
            <span class="status-indicator status-unknown" id="statusLight"></span>
            <span id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <button onclick="checkBackendStatus()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <div class="test-section">
        <h2>üìù –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
        <div class="log" id="eventLog"></div>
    </div>

    <div class="test-section">
        <h2>üîß –¢–µ—Å—Ç—ã</h2>
        <button onclick="testHealthEndpoint()">üè• Health Endpoint</button>
        <button onclick="testAdminHealth()">üë®‚Äçüíº Admin Health</button>
        <button onclick="testPostsAPI()">üìù Posts API</button>
        <button onclick="simulateBackendDown()">üí• –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è</button>
    </div>

    <script>
        let logElement = document.getElementById('eventLog');
        let statusLight = document.getElementById('statusLight');
        let statusText = document.getElementById('statusText');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            logElement.innerHTML = '';
        }

        function updateStatus(isOnline) {
            statusLight.className = 'status-indicator ' + (isOnline ? 'status-online' : 'status-offline');
            statusText.textContent = isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω';
        }

        async function checkBackendStatus() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±—ç–∫–µ–Ω–¥–∞...', 'info');
            
            try {
                const response = await fetch('http://localhost:8000/api/admin/health', {
                    method: 'GET',
                    timeout: 5000
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ –ë—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç: ${data.status}`, 'success');
                    updateStatus(true);
                } else {
                    log(`‚ùå –ë—ç–∫–µ–Ω–¥ –æ—à–∏–±–∫–∞: HTTP ${response.status}`, 'error');
                    updateStatus(false);
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                updateStatus(false);
            }
        }

        async function testHealthEndpoint() {
            log('üè• –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ /api/health...', 'info');
            
            try {
                const response = await fetch('http://localhost:8000/api/health');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Health OK: ${data.status}`, 'success');
                } else {
                    log(`‚ùå Health Error: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Health Error: ${error.message}`, 'error');
            }
        }

        async function testAdminHealth() {
            log('üë®‚Äçüíº –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ /api/admin/health...', 'info');
            
            try {
                const response = await fetch('http://localhost:8000/api/admin/health');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Admin Health OK: ${data.status}`, 'success');
                } else {
                    log(`‚ùå Admin Health Error: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Admin Health Error: ${error.message}`, 'error');
            }
        }

        async function testPostsAPI() {
            log('üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ /api/posts...', 'info');
            
            try {
                const response = await fetch('http://localhost:8000/api/posts');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Posts API OK: ${data.posts?.length || 0} –ø–æ—Å—Ç–æ–≤`, 'success');
                } else {
                    log(`‚ùå Posts API Error: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Posts API Error: ${error.message}`, 'error');
            }
        }

        function simulateBackendDown() {
            log('üí• –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞...', 'warning');
            updateStatus(false);
            log('‚ö†Ô∏è –°—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ "–û—Ñ–ª–∞–π–Ω"', 'warning');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å...', 'info');
            checkBackendStatus();
        };

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(checkBackendStatus, 10000);
    </script>
</body>
</html> 